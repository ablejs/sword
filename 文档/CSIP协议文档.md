
## 云安通讯Tcp通讯协议

> 安卓APP与云端通讯，实现语音等传输

---
### 协议包格式

协议头+功能码+数据长度+数据主体+结束符

#### 协议头:`CSIP` (固定值)
-- 云安会话发起协议 CloudAn Session Initiation Protocol
-- 长度：4

#### 功能码:`C01A`
-- 用ASCII码表示功能码，第一位为[C,B]，C表示客户端上报，S表示服务端推送
-- 注：客户端上传为C开头，服务端返回也为C，反之客户端返回服务端消息也为S开头
-- 长度：4
100000
#### 数据长度:`003500`(十进制)
-- 数据长度，介于功能码至结束符之间，若不足长度前面填充0
-- 长度：6

#### 数据主体
-- 数据主体会根据不同功能码，结构有所不同，详情看功能码对应的文档
-- 长度：@数据长度
> 参数长度 (4位) 以|结束
> 参数值 (key=value&kry2=value2|)
> 数据内容 (若消息体内存在body_len字段，则向后取出相应长度的数据)

#### 结束符:`"\r\n"` (固定值)
-- 长度：2

---

### 协议功能码

#### 功能一览
| 功能码      | 说明        |
| ----------- | ----------- |
| C01A | 登录绑定用户,云安账号或手机设备码自动登录 |
| C01B | 注销用户登录 |
| C02A | 获取用户组 |
| C02B | 获取用户组成员 |
| C03A | 上传文字消息 |
| C03B | 上传语音消息 |
| C03C | 上传图片消息 |
| S03B | 服务器推送语音 |

#### app广播事件
广播消息功能码可为空（0000）
设置broadcast参数为1
设置event为事件名称
bodyData为事件数据

#### 上传语音消息

功能码：C03B
数据主体：

> send_type 发送方式：1(私发) 2(群组) 3(指定接收人)
> recipient 接收对象：根据发送方式而定
> send_time 发送时间: 当前10位时间戳
> data_type 数据类型: message base64_aar base64_jpg aar jpg ...
> body_len  数据长度: 真实数据长度，int值
>  |数据


